% -*- mode: latex; coding: utf-8 -*-
% !TEX TS-program = pdflatexmk
% !TEX encoding = UTF-8 Unicode

\documentclass[%
  a4paper,
  twoside,
  numbers=noenddot,
  parskip=half+,
  open=any,
  headsepline,
  english, % german, english
  ba  % ba, pa
]{zhawthesis}

\usepackage{etoolbox}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameters
% - Adjust these to your needs:

\title{Functional Go}
\subtitle{an easier introduction to functional programming}
\author{% Komma getrennt
    Ramon Rüttimann
}
\newcommand\twodigits[1]{\ifnum#1<10 0#1\else #1\fi}
\date{\twodigits{\the\day}.\twodigits{\number\month}.\the\year}

\major{Computer Science}  % Studiengang
\zhawsemester{Spring 2020}
\zhawinstitute{init}
\zhawlogocolour{pantone2945}  % pantone2945, cmyk, sw
\mainsupervisor{Dr. G. Burkert}
\subsupervisor{Dr. K. Rege}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Base packages used by the template (any commonly used packages)

\usepackage{float}
\usepackage{graphicx}
\graphicspath{{figures/}}
\DeclareGraphicsExtensions{.pdf,.png,.jpg,.gif}

\usepackage{tabularx}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{todonotes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom packages
% - Add packages used by your thesis here:

\usepackage{hyperref}
\usepackage[newfloat]{minted}
\usepackage{listings}
\newenvironment{code}{\captionsetup{type=listing}}{}
\SetupFloatingEnvironment{listing}{name=Source Code}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\newminted{go}{breaklines,breakbytoken,tabsize=2,bgcolor=bg}
\newminted{bash}{breaklines,breakbytoken,tabsize=2,bgcolor=bg}
\newminted{haskell}{breaklines,breakbytoken,tabsize=2,bgcolor=bg}
\newmintedfile{go}{breaklines,breakanywhere,tabsize=2,bgcolor=bg,linenos,stepnumber=5,numberfirstline}


\newcommand{\gofilerange}[4][]{%
    \immediate\write18{./utils/delim -file="#2" -start="#3" -end="#4"}
    \IfFileExists{code.lineno}
      {\CatchFileEdef{\linenumber}{./code.lineno}{\endlinechar=-1 }}
      {\def\linenumber{0}}
    \edef\flags{firstnumber=\linenumber,#1}
    \expandafter\gofile\expandafter[\flags]{./code.snippet}
}


\usepackage[
    backend=biber,
    style=ieee,
]{biblatex}
\usepackage{caption}
\usepackage[toc,page]{appendix}
\usepackage{glossaries}
%\usepackage{listings}
\makeglossaries
%\usepackage{csquotes}
\AtBeginEnvironment{quote}{\itshape}
%\bibliography{thesis}
\addbibresource{thesis.bib}

\begin{document}

\frontmatter

\maketitle

\cleardoublepage % chktex 1


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Declaration of Originality

\makedeclarationoforiginality % chktex 1


\cleardoublepage % chktex 1


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\IfLanguageName{nswissgerman}{\chapter{Zusammenfassung}}{\chapter{Summary}}
\label{ch:summary} % chktex 24
\input{chapters/01_zusammenfassung.tex}

\chapter{Abstract}
\label{ch:abstract} % chktex 24
\input{chapters/02_abstract.tex}

\IfLanguageName{nswissgerman}{\chapter{Vorwort}}{\chapter{Preface}}
\label{ch:preface} % chktex 24
\input{chapters/10_preface.tex}

\cleardoublepage % chktex 1


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\mainmatter % chktex 1

\tableofcontents

\IfLanguageName{nswissgerman}{\chapter{Einleitung}}{\chapter{Introduction}}
\label{ch:introduction} % chktex 24
\input{chapters/20_introduction.tex}

% DISABLE RELATED WORK AS I PUT THAT INTO THE INTRO
%\IfLanguageName{nswissgerman}{\chapter{Verwandte Arbeit}}{\chapter{Related Work}}
%\label{ch:related-work} % chktex 24
%\input{chapters/30_related_work.tex}

\IfLanguageName{nswissgerman}{\chapter{Methoden}}{\chapter{Methodology}}
\label{ch:methodology} % chktex 24
\input{chapters/30_methodology.tex}

\chapter{Implementation}
\label{ch:implementation} % chktex 24
\input{chapters/40_implementation.tex}

\chapter{Application}
\label{ch:application} % chktex 24
\input{chapters/50_application.tex}

\IfLanguageName{nswissgerman}{\chapter{Resultate}}{\chapter{Experiments and Results}}
\label{ch:results} % chktex 24
\input{chapters/60_results.tex}

\IfLanguageName{nswissgerman}{\chapter{Diskussion}}{\chapter{Discussion}}
\label{ch:discussion} % chktex 24
\input{chapters/70_discussion.tex}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\backmatter % chktex 1

% \let\clearpage\relax
% \vspace{-4em}
\printbibliography
% \endgroup

\renewcommand{\lstlistlistingname}{List of source codes}

\lstlistoflistings

% \begingroup
% \let\clearpage\relax
% \vspace{-4em}
\listoffigures
% \endgroup

% \begingroup
% \let\clearpage\relax
% \vspace{-4em}
\listoftables
\printglossaries
% \endgroup
\cleardoublepage % chktex 1


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\appendix
\begin{appendices}

\section{Analysis of function occurrences in Haskell code}\label{appendix:function-occurrences}
The results of the analysis have been aquired by running the following command
from the root of the git repository\cite{git-repo}:
\begin{bashcode}
./work/common-list-functions/count-function.sh "map " " : " "fold" "filter " "reverse " "take " "drop " "maximum" "sum " "zip " "product " "minimum " "reduce "
\end{bashcode}

\section{Workaround for the missing foldl' implementation in Go}\label{appendix:foldl-go}
\begin{code}
    \captionof{listing}{Working around the missing foldl implementation in Go}
    \label{code:foldl-go}
    \begin{gocode}
package main

import "fmt"

func main() {
        zero, one, two, three := 0, 1, 2, 3
        list := []*int{&one, &two, nil, &three, &zero}

        // this will work, as the values will be evaluated
        // "lazily" - the nested functions will never
        // be executed, thus it will never panic.
        fmt.Printf("%v\n", myFold(mulLazy, 1, list))
        // This will panic.
        fmt.Printf("%v\n", foldl(mul, 1, list))
}

func mul(x int, y *int) int {
        if *y == 0 {
                return 0
        }
        return x * *y
}

func mulLazy(x func() int, y *int) func() int {
        return func() int {
                if *y == 0 {
                        return 0
                }
                return x() * *y
        }
}

func myFold(f func(func() int, *int) func() int, acc int, list []*int) int {
        a := func() int { return acc }
        a = foldl(f, a, list)
        return a()
}
    \end{gocode}
    \begin{bashcode}
$> fgo run .
0
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x109e945]

goroutine 1 [running]:
main.what(0x2, 0x0, 0x2)
        /tmp/map/main.go:16 +0x5
main.main()
        /tmp/map/main.go:12 +0x187
exit status 2
    \end{bashcode}
\end{code}

% - Add your appendix here:

\todo[inline]{
  Anhang/Appendix:

  \quad -- Projektmanagement: \\ % chktex 8
  \qquad -- Offizielle Aufgabenstellung, Projektauftrag \\ % chktex 8
  \qquad -- (Zeitplan) \\ % chktex 8
  \qquad -- (Besprechungsprotokolle oder Journals) % chktex 8

  \quad -- Weiteres: \\ % chktex 8
  \qquad -- CD/USB-Stick mit dem vollständigen Bericht als PDF-File inklusive Film- und Fotomaterial \\ % chktex 8
  \qquad -- (Schaltpläne und Ablaufschemata) \\ % chktex 8
  \qquad -- (Spezifikation u. Datenblätter der verwendeten Messgeräte und/oder Komponenten) \\ % chktex 8
  \qquad -- (Berechnungen, Messwerte, Simulationsresultate) \\ % chktex 8
  \qquad -- (Stoffdaten) \\ % chktex 8
  \qquad -- (Fehlerrechnungen mit Messunsicherheiten) \\ % chktex 8
  \qquad -- (Grafische Darstellungen, Fotos) \\ % chktex 8
  \qquad -- (Datenträger mit weiteren Daten (z. B. Software-Komponenten) inkl. Verzeichnis der auf diesem Datenträger abgelegten Dateien) \\ % chktex 8
  \qquad -- (Softwarecode) % chktex 8
}

\end{appendices}

\end{document}
